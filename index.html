<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kreftforeningens flertallskalkulator for Stortinget</title>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-image">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 60" width="140">
        <!-- Fargerike blomsterbladet logo -->
        <g transform="translate(10,10) scale(0.9)">
            <!-- Turkis blad -->
            <path fill="#00B8B0" d="M44,30c-6-6-15-7-22-2c4-7,2-16-4-21c10,1,19,8,22,17c1-2,1-4,1-6c7,6,8,16,4,23C48,37,47,33,44,30z"/>
            <!-- Grønt blad -->
            <path fill="#8CC63F" d="M30,44c6,6,15,7,22,2c-4,7-2,16,4,21c-10-1-19-8-22-17c-1,2-1,4-1,6c-7-6-8-16-4-23C26,37,27,41,30,44z"/>
            <!-- Lilla blad -->
            <path fill="#662D91" d="M44,44c6-6,7-15,2-22c7,4,16,2,21-4c-1,10-8,19-17,22c2,1,4,1,6,1c-6,7-16,8-23,4C37,48,41,47,44,44z"/>
            <!-- Rosa blad -->
            <path fill="#D4145A" d="M30,30c-6,6-7,15-2,22c-7-4-16-2-21,4c1-10,8-19,17-22c-2-1-4-1-6-1c6-7,16-8,23-4C37,26,33,27,30,30z"/>
        </g>
        <!-- Tekst "KREFTFORENINGEN" -->
        <text x="70" y="30" font-family="'Segoe UI', Arial, sans-serif" font-weight="bold" font-size="16" fill="#000000">KREFT</text>
        <text x="120" y="30" font-family="'Segoe UI', Arial, sans-serif" font-size="16" fill="#000000">FORENINGEN</text>
    </svg>
</div>
            <h1>Kreftforeningens flertallskalkulator for Stortinget</h1>
        </header>
        
        <div class="description">
            <p>Velg partiene som stemmer <strong>for</strong> forslaget for å se om det oppnår flertall på Stortinget.</p>
            <p class="info-text">Stortinget har totalt 169 representanter. Et forslag trenger minst 85 stemmer for å få flertall.</p>
        </div>
        
        <div class="two-column">
            <div class="column">
                <div class="party-grid" id="partyGrid">
                    <!-- Party cards will be added here by JavaScript -->
                </div>
                
                <div class="action-buttons">
                    <button class="btn-primary" id="selectAllBtn">Velg alle</button>
                    <button class="btn-secondary" id="clearAllBtn">Fjern alle</button>
                </div>
            </div>
            
            <div class="column">
                <h2 class="section-title">Blokkvisualisering av Stortinget</h2>
                
                <div class="parliament-visualization">
                    <div class="parliament-container">
                        <div class="parliament-seats" id="parliamentSeats">
                            <!-- Seats will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="parliament-legend" id="parliamentLegend">
                    <!-- Legend will be generated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="result-container">
            <h2 class="result-header">Resultat</h2>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-labels">
                    <span id="votesFor">0</span>
                    <span id="votesAgainst">169</span>
                </div>
            </div>
            
            <div class="result-details">
                <div class="result-box required-votes">
                    <div class="result-value">85</div>
                    <div class="result-label">Stemmer nødvendig for flertall</div>
                </div>
                
                <div class="result-box votes-for">
                    <div class="result-value" id="totalVotesFor">0</div>
                    <div class="result-label">Stemmer for</div>
                </div>
                
                <div class="result-box votes-against">
                    <div class="result-value" id="totalVotesAgainst">169</div>
                    <div class="result-label">Stemmer mot</div>
                </div>
            </div>
            
            <div class="result-status no-majority" id="majorityStatus">
                Ingen flertall (trenger 85 stemmer minst)
            </div>
            
            <div class="selected-parties">
                <h3 class="selected-parties-title">Partier som stemmer for:</h3>
                <div id="selectedPartyTags"></div>
            </div>
        </div>
        
        <footer>
            Data basert på mandatfordeling etter Stortingsvalget 2021. Til bruk for informasjonsformål.
        </footer>
    </div>
    
    <script>
        // Party data with colors and shorthand, sorted by political position (left to right)
        const parties = [
            { name: "Rødt", seats: 8, shorthand: "R", color: "#da291c", classPrefix: "r", position: 1 },
            { name: "Sosialistisk Venstreparti", seats: 13, shorthand: "SV", color: "#eb2e2d", classPrefix: "sv", position: 2 },
            { name: "Arbeiderpartiet", seats: 48, shorthand: "AP", color: "#ed1b34", classPrefix: "ap", position: 3 },
            { name: "Miljøpartiet De Grønne", seats: 3, shorthand: "MDG", color: "#439539", classPrefix: "mdg", position: 4 },
            { name: "Senterpartiet", seats: 28, shorthand: "SP", color: "#14773c", classPrefix: "sp", position: 5 },
            { name: "Venstre", seats: 8, shorthand: "V", color: "#00807b", classPrefix: "v", position: 6 },
            { name: "Kristelig Folkeparti", seats: 3, shorthand: "KrF", color: "#ffbe00", classPrefix: "krf", position: 7 },
            { name: "Høyre", seats: 36, shorthand: "H", color: "#007ac8", classPrefix: "h", position: 8 },
            { name: "Fremskrittspartiet", seats: 21, shorthand: "FrP", color: "#002e5e", classPrefix: "frp", position: 9 },
            { name: "Pasientfokus", seats: 1, shorthand: "PF", color: "#a04d94", classPrefix: "pf", position: 10 }
        ];

        // Required votes for majority
        const TOTAL_SEATS = 169;
        const MAJORITY_THRESHOLD = 85;

        // DOM elements
        const partyGrid = document.getElementById('partyGrid');
        const progressBar = document.getElementById('progressBar');
        const votesForLabel = document.getElementById('votesFor');
        const votesAgainstLabel = document.getElementById('votesAgainst');
        const totalVotesFor = document.getElementById('totalVotesFor');
        const totalVotesAgainst = document.getElementById('totalVotesAgainst');
        const majorityStatus = document.getElementById('majorityStatus');
        const selectedPartyTags = document.getElementById('selectedPartyTags');
        const selectAllBtn = document.getElementById('selectAllBtn');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const parliamentSeats = document.getElementById('parliamentSeats');
        const parliamentLegend = document.getElementById('parliamentLegend');

        // Create party cards
        parties.forEach(party => {
            const partyCard = document.createElement('div');
            partyCard.className = 'party-card';
            partyCard.dataset.seats = party.seats;
            partyCard.dataset.name = party.name;
            partyCard.dataset.shorthand = party.shorthand;
            partyCard.dataset.classPrefix = party.classPrefix;
            
            const partyIcon = document.createElement('span');
            partyIcon.className = `party-icon icon-${party.classPrefix}`;
            partyIcon.textContent = party.shorthand.charAt(0);
            
            const partyName = document.createElement('span');
            partyName.className = 'party-name';
            partyName.textContent = party.name;
            
            const partySeats = document.createElement('span');
            partySeats.className = 'party-seats';
            partySeats.textContent = party.seats;
            
            partyCard.appendChild(partyIcon);
            partyCard.appendChild(partyName);
            partyCard.appendChild(partySeats);
            
            partyCard.addEventListener('click', () => toggleParty(partyCard));
            
            partyGrid.appendChild(partyCard);
        });

        // Toggle party selection
        function toggleParty(partyCard) {
            partyCard.classList.toggle('selected');
            updateResults();
            updateVisualization();
        }

        // Select all parties
        selectAllBtn.addEventListener('click', () => {
            document.querySelectorAll('.party-card').forEach(card => {
                card.classList.add('selected');
            });
            updateResults();
            updateVisualization();
        });

        // Clear all selections
        clearAllBtn.addEventListener('click', () => {
            document.querySelectorAll('.party-card').forEach(card => {
                card.classList.remove('selected');
            });
            updateResults();
            updateVisualization();
        });

        // Update results based on selections
        function updateResults() {
            const selectedParties = Array.from(document.querySelectorAll('.party-card.selected'));
            const votesFor = selectedParties.reduce((total, party) => total + parseInt(party.dataset.seats), 0);
            const votesAgainst = TOTAL_SEATS - votesFor;
            const hasMajority = votesFor >= MAJORITY_THRESHOLD;
            
            // Update progress bar
            const percentage = (votesFor / TOTAL_SEATS) * 100;
            progressBar.style.width = `${percentage}%`;
            
            if (hasMajority) {
                progressBar.classList.add('majority');
            } else {
                progressBar.classList.remove('majority');
            }
            
            // Update vote counters
            votesForLabel.textContent = votesFor;
            votesAgainstLabel.textContent = votesAgainst;
            totalVotesFor.textContent = votesFor;
            totalVotesAgainst.textContent = votesAgainst;
            
            // Update majority status
            if (hasMajority) {
                majorityStatus.className = 'result-status has-majority';
                majorityStatus.textContent = `Flertall oppnådd med ${votesFor} stemmer`;
            } else {
                majorityStatus.className = 'result-status no-majority';
                const votesNeeded = MAJORITY_THRESHOLD - votesFor;
                majorityStatus.textContent = `Ingen flertall (trenger ${votesNeeded} flere stemmer)`;
            }
            
            // Update selected party tags
            selectedPartyTags.innerHTML = '';
            if (selectedParties.length === 0) {
                const noPartyTag = document.createElement('span');
                noPartyTag.className = 'party-tag';
                noPartyTag.textContent = 'Ingen partier valgt';
                selectedPartyTags.appendChild(noPartyTag);
            } else {
                selectedParties.forEach(party => {
                    const tag = document.createElement('span');
                    tag.className = `party-tag party-tag-${party.dataset.classPrefix}`;
                    tag.textContent = `${party.dataset.shorthand} (${party.dataset.seats})`;
                    selectedPartyTags.appendChild(tag);
                });
            }
        }

        // Create parliament visualization
        function createParliamentVisualization() {
            // Clear previous seats
            parliamentSeats.innerHTML = '';
            
            // Sort parties from left to right based on political position
            const sortedParties = [...parties].sort((a, b) => a.position - b.position);
            
            // Total seats counter to verify
            let totalCreatedSeats = 0;
            
            // Create a hemicycle visualization with multiple rows
            const rowCount = 8; // Number of rows in the parliament
            const rows = [];
            
            // Initialize empty rows
            for (let i = 0; i < rowCount; i++) {
                const row = document.createElement('div');
                row.className = 'parliament-row';
                // Make the rows curve by adjusting width - outer rows are wider
                const rowWidth = 50 + Math.sin(Math.PI * (i / (rowCount - 1))) * 45;
                row.style.width = `${rowWidth}%`;
                rows.push(row);
                parliamentSeats.appendChild(row);
            }
            
            // Simplified approach: Divide the rows into left-to-right "columns"
            // For each party, get their proportional number of seats
            // Create party blocks in each row
            
            // We'll distribute parties from left to right in each row
            
            // Calculate number of "slots" per row
            // Each party will get a number of slots proportional to its size
            const slotsPerRow = [];
            for (let i = 0; i < rowCount; i++) {
                // Calculate based on row width
                const rowWidth = 50 + Math.sin(Math.PI * (i / (rowCount - 1))) * 45;
                const slots = Math.floor(TOTAL_SEATS * (rowWidth / 95) / rowCount * 1.2);
                slotsPerRow.push(slots);
            }
            
            // Calculate total number of slots
            const totalSlots = slotsPerRow.reduce((a, b) => a + b, 0);
            
            // Calculate seats per party per row - must sum to their actual seats
            const partyRowAllocation = {};
            
            // Initialize allocation
            sortedParties.forEach(party => {
                partyRowAllocation[party.shorthand] = Array(rowCount).fill(0);
            });
            
            // Allocate seats for each party
            sortedParties.forEach(party => {
                let seatsRemaining = party.seats;
                
                // Calculate ideal distribution across rows
                const idealSeatsPerRow = rows.map((_, rowIndex) => {
                    const proportion = slotsPerRow[rowIndex] / totalSlots;
                    return Math.round(party.seats * proportion);
                });
                
                // Adjust to ensure totals match
                for (let rowIndex = 0; rowIndex < rowCount && seatsRemaining > 0; rowIndex++) {
                    const idealSeats = idealSeatsPerRow[rowIndex];
                    partyRowAllocation[party.shorthand][rowIndex] = Math.min(idealSeats, seatsRemaining);
                    seatsRemaining -= partyRowAllocation[party.shorthand][rowIndex];
                }
                
                // If we still have seats to assign, add them to rows from the front
                for (let rowIndex = rowCount - 1; rowIndex >= 0 && seatsRemaining > 0; rowIndex--) {
                    partyRowAllocation[party.shorthand][rowIndex]++;
                    seatsRemaining--;
                }
            });
            
            // Verify each party has the correct number of seats allocated
            sortedParties.forEach(party => {
                const totalAllocated = partyRowAllocation[party.shorthand].reduce((a, b) => a + b, 0);
                if (totalAllocated !== party.seats) {
                    console.error(`Party ${party.name} allocated ${totalAllocated} seats, expected ${party.seats}`);
                }
            });
            
            // Create seats for each row
            let seatIndex = 0;
            
            for (let rowIndex = 0; rowIndex < rowCount; rowIndex++) {
                const row = rows[rowIndex];
                
                // Process each party in order from left to right
                for (let partyIndex = 0; partyIndex < sortedParties.length; partyIndex++) {
                    const party = sortedParties[partyIndex];
                    const seatsForPartyInRow = partyRowAllocation[party.shorthand][rowIndex];
                    
                    // Add seats for this party in this row
                    for (let i = 0; i < seatsForPartyInRow; i++) {
                        const seat = document.createElement('div');
                        seat.className = 'seat';
                        seat.style.backgroundColor = party.color;
                        seat.dataset.party = party.shorthand;
                        seat.dataset.index = seatIndex++;
                        row.appendChild(seat);
                        totalCreatedSeats++;
                    }
                }
            }
            
            console.log(`Created ${totalCreatedSeats} total seats, expected ${TOTAL_SEATS}`);
            
            // Create legend
            parliamentLegend.innerHTML = '';
            sortedParties.forEach(party => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const legendColor = document.createElement('div');
                legendColor.className = 'legend-color';
                legendColor.style.backgroundColor = party.color;
                
                const legendText = document.createElement('span');
                legendText.textContent = `${party.name} (${party.seats})`;
                
                legendItem.appendChild(legendColor);
                legendItem.appendChild(legendText);
                parliamentLegend.appendChild(legendItem);
            });
            
            // Validate seat counts
            const seatCounts = {};
            document.querySelectorAll('.seat').forEach(seat => {
                const party = seat.dataset.party;
                seatCounts[party] = (seatCounts[party] || 0) + 1;
            });
            
            sortedParties.forEach(party => {
                const count = seatCounts[party.shorthand] || 0;
                if (count !== party.seats) {
                    console.error(`Party ${party.name} has ${count} seats in visualization, expected ${party.seats}`);
                }
            });
        }

        // Update visualization based on party selection
        function updateVisualization() {
            const selectedParties = Array.from(document.querySelectorAll('.party-card.selected'));
            const selectedPartyShorthands = selectedParties.map(party => party.dataset.shorthand);
            
            // Update seat styling
            document.querySelectorAll('.seat').forEach(seat => {
                if (selectedPartyShorthands.includes(seat.dataset.party)) {
                    seat.classList.add('active');
                } else {
                    seat.classList.remove('active');
                }
            });
        }

        // Initialize
        createParliamentVisualization();
        updateResults();
        updateVisualization();
    </script>
</body>
</html>
